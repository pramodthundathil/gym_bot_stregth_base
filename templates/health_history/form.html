<!DOCTYPE html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="{%static 'assets/images/Logo_Reveal_Slides.png' %}" />

    <title>{% if is_new %}Create{% else %}Edit{% endif %} Health History - {{ member.First_Name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gym-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .mandatory-field {
            color: #dc3545;
            font-weight: bold;
        }
        .section-header {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 1rem;
            margin: 2rem 0 1rem 0;
            border-radius: 0.5rem;
        }
        .form-group {
            margin-bottom: 1rem;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        .checkbox-group input[type="checkbox"] {
            margin-right: 0.5rem;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
        }
        .medication-formset {
            border: 2px solid #e9ecef;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .delete-medication {
            color: #dc3545;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="gym-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <img src="{% static 'assets/images/Logo_Reveal_Slides.png' %}" alt="Strength Base Fitness Logo" style="width: 100px;" />

                    <!-- <h1> STRENGTH BASE</h1> -->
                    <p class="mb-0">Opp Heera Apartments Tank Bund Road, Chilavannur Rd, Kochi, Kerala 682020</p>
                </div>
                <div class="col-md-4 text-end">
                    <h3>Health History Questionnaire</h3>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h4><i class="fas fa-user-md"></i> {% if is_new %}Create{% else %}Edit{% endif %} Health History for {{ member.First_Name }} {{ member.Last_Name }}</h4>
                        <small class="text-muted">Fields marked with <span class="mandatory-field">*</span> are mandatory</small>
                    </div>
                    <div class="card-body">
                        <form method="post" id="health-history-form">
                            {% csrf_token %}
                            
                            <!-- Member Information Display -->
                            <div class="section-header">
                                <h5><i class="fas fa-user"></i> Member Information</h5>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <p><strong>Name:</strong> {{ member.First_Name }} {{ member.Last_Name }}</p>
                                </div>
                                <div class="col-md-4">
                                    <p><strong>Mobile:</strong> {{ member.Mobile_Number }}</p>
                                </div>
                                <div class="col-md-4">
                                    <p><strong>Email:</strong> {{ member.Email|default:"Not provided" }}</p>
                                </div>
                            </div>

                            <!-- Emergency Contact Information -->
                            <div class="section-header">
                                <h5><i class="fas fa-phone-alt"></i> Emergency Contact Information <span class="mandatory-field">*</span></h5>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Emergency Contact Name <span class="mandatory-field">*</span></label>
                                        {{ form.emergency_contact_name }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Relationship <span class="mandatory-field">*</span></label>
                                        {{ form.emergency_contact_relationship }}
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Emergency Contact Phone <span class="mandatory-field">*</span></label>
                                        {{ form.emergency_contact_phone }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Emergency Contact Address</label>
                                        {{ form.emergency_contact_address }}
                                    </div>
                                </div>
                            </div>

                            <!-- Physical Information -->
                            <div class="section-header">
                                <h5><i class="fas fa-weight"></i> Current Physical Information <span class="mandatory-field">*</span></h5>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Current Weight (KG) <span class="mandatory-field">*</span></label>
                                        {{ form.current_weight }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Current Height (CM) <span class="mandatory-field">*</span></label>
                                        {{ form.current_height }}
                                    </div>
                                </div>
                            </div>

                            <!-- Fitness Goals -->
                            <div class="section-header">
                                <h5><i class="fas fa-target"></i> Fitness Goals <span class="mandatory-field">*</span></h5>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Primary Fitness Goal <span class="mandatory-field">*</span></label>
                                        {{ form.fitness_goal }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Goal Details</label>
                                        {{ form.fitness_goal_details }}
                                    </div>
                                </div>
                            </div>

                            <!-- PT Session Availability -->
                            <div class="section-header">
                                <h5><i class="fas fa-calendar-alt"></i> PT Session Availability <span class="mandatory-field">*</span></h5>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Preferred Time <span class="mandatory-field">*</span></label>
                                        {{ form.pt_availability }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Preferred Days <span class="mandatory-field">*</span></label>
                                        {{ form.preferred_days }}
                                    </div>
                                </div>
                            </div>

                            <!-- Physician Information -->
                            <div class="section-header">
                                <h5><i class="fas fa-stethoscope"></i> Physician Information</h5>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Physician Name</label>
                                        {{ form.physician_name }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Physician Phone</label>
                                        {{ form.physician_phone }}
                                    </div>
                                </div>
                            </div>

                            <!-- Current Medical Care -->
                            <div class="section-header">
                                <h5><i class="fas fa-hospital"></i> Current Medical Care</h5>
                            </div>
                            <div class="form-group">
                                <div class="checkbox-group">
                                    {{ form.under_medical_care }}
                                    <label>Are you under the care of a physician, chiropractor, or other health care professional?</label>
                                </div>
                                {{ form.medical_care_reason }}
                            </div>

                            <!-- Medications -->
                            <div class="section-header">
                                <h5><i class="fas fa-pills"></i> Medications</h5>
                            </div>
                            <div class="form-group">
                                <div class="checkbox-group">
                                    {{ form.taking_medications }}
                                    <label>Are you currently taking any medications?</label>
                                </div>
                            </div>
                            
                            <div id="medication-section">
                                {{ medication_formset.management_form }}
                                {% for medication_form in medication_formset %}
                                    <div class="medication-formset">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <h6>Medication {{ forloop.counter }}</h6>
                                            {% if not medication_form.instance.pk %}
                                                <span class="delete-medication" onclick="removeMedicationForm(this)">
                                                    <i class="fas fa-trash"></i> Remove
                                                </span>
                                            {% endif %}
                                        </div>
                                        {% if medication_form.non_field_errors %}
                                            <div class="alert alert-danger">{{ medication_form.non_field_errors }}</div>
                                        {% endif %}
                                        {{ medication_form.DELETE }}
                                        <div class="row">
                                            <div class="col-md-4">
                                                <label>Medication Type</label>
                                                {{ medication_form.medication_type }}
                                            </div>
                                            <div class="col-md-4">
                                                <label>Dosage/Frequency</label>
                                                {{ medication_form.dosage_frequency }}
                                            </div>
                                            <div class="col-md-4">
                                                <label>Reason for Taking</label>
                                                {{ medication_form.reason_for_taking }}
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                            <button type="button" class="btn btn-secondary mb-3" onclick="addMedicationForm()">
                                <i class="fas fa-plus"></i> Add Another Medication
                            </button>

                            <!-- Allergies -->
                            <div class="section-header">
                                <h5><i class="fas fa-exclamation-triangle"></i> Allergies</h5>
                            </div>
                            <div class="form-group">
                                <label>Please list any allergies</label>
                                {{ form.allergies }}
                            </div>

                            <!-- Basic Health Questions -->
                            <div class="section-header">
                                <h5><i class="fas fa-heartbeat"></i> Basic Health Questions</h5>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="checkbox-group">
                                        {{ form.high_blood_pressure }}
                                        <label>Has your doctor ever said your blood pressure was too high?</label>
                                    </div>
                                    <div class="checkbox-group">
                                        {{ form.bone_joint_problems }}
                                        <label>Have you been told you have bone/joint problems that could be worsened by exercise?</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="checkbox-group">
                                        {{ form.over_65 }}
                                        <label>Are you over the age of 65?</label>
                                    </div>
                                    <div class="checkbox-group">
                                        {{ form.unaccustomed_exercise }}
                                        <label>Are you unaccustomed to vigorous exercise?</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Family Medical History -->
                            <div class="section-header">
                                <h5><i class="fas fa-users"></i> Family & Personal Medical History</h5>
                                <small>Check box for family history, fill details for personal conditions</small>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="checkbox-group">
                                        {{ form.family_asthma }}
                                        <label>Family History of Asthma</label>
                                    </div>
                                    <div class="form-group">
                                        <label>Personal Asthma Details</label>
                                        {{ form.personal_asthma }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="checkbox-group">
                                        {{ form.family_respiratory }}
                                        <label>Family History of Respiratory Conditions</label>
                                    </div>
                                    <div class="form-group">
                                        <label>Personal Respiratory Condition Details</label>
                                        {{ form.personal_respiratory }}
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="checkbox-group">
                                        {{ form.family_diabetes }}
                                        <label>Family History of Diabetes</label>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <label>Type I Diabetes</label>
                                            {{ form.personal_diabetes_type1 }}
                                        </div>
                                        <div class="col-md-4">
                                            <label>Type II Diabetes</label>
                                            {{ form.personal_diabetes_type2 }}
                                        </div>
                                        <div class="col-md-4">
                                            <label>How Long?</label>
                                            {{ form.diabetes_duration }}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="checkbox-group">
                                        {{ form.family_epilepsy }}
                                        <label>Family History of Epilepsy</label>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <label>Petite Mal</label>
                                            {{ form.personal_epilepsy_petite }}
                                        </div>
                                        <div class="col-md-4">
                                            <label>Grand Mal</label>
                                            {{ form.personal_epilepsy_grand }}
                                        </div>
                                        <div class="col-md-4">
                                            <label>Other</label>
                                            {{ form.personal_epilepsy_other }}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="checkbox-group">
                                        {{ form.family_osteoporosis }}
                                        <label>Family History of Osteoporosis</label>
                                    </div>
                                    <div class="form-group">
                                        <label>Personal Osteoporosis Details</label>
                                        {{ form.personal_osteoporosis }}
                                    </div>
                                </div>
                            </div>

                            <!-- Lifestyle Factors -->
                            <div class="section-header">
                                <h5><i class="fas fa-life-ring"></i> Lifestyle & Dietary Factors</h5>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Occupational Stress Level</label>
                                        {{ form.occupational_stress }}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Energy Level</label>
                                        {{ form.energy_level }}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Caffeine Intake/Daily</label>
                                        {{ form.caffeine_daily }}
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Alcohol Intake/Weekly</label>
                                        {{ form.alcohol_weekly }}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Colds Per Year</label>
                                        {{ form.colds_per_year }}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Anemia</label>
                                        {{ form.anemia }}
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Gastrointestinal Disorder</label>
                                        {{ form.gastrointestinal_disorder }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Hypoglycemia</label>
                                        {{ form.hypoglycemia }}
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Thyroid Disorder</label>
                                        {{ form.thyroid_disorder }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Pre/Postnatal Information</label>
                                        {{ form.prenatal_postnatal }}
                                    </div>
                                </div>
                            </div>

                            <!-- Cardiovascular -->
                            <div class="section-header">
                                <h5><i class="fas fa-heart"></i> Cardiovascular Information</h5>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>High Blood Pressure Details</label>
                                        {{ form.high_bp_details }}
                                    </div>
                                    <div class="form-group">
                                        <label>High Cholesterol</label>
                                        {{ form.high_cholesterol }}
                                    </div>
                                    <div class="form-group">
                                        <label>Heart Disease</label>
                                        {{ form.heart_disease }}
                                    </div>
                                    <div class="form-group">
                                        <label>Heart Attack</label>
                                        {{ form.heart_attack }}
                                    </div>
                                    <div class="form-group">
                                        <label>Angina</label>
                                        {{ form.angina }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Hypertension Details</label>
                                        {{ form.hypertension_details }}
                                    </div>
                                    <div class="form-group">
                                        <label>Hyperlipidemia</label>
                                        {{ form.hyperlipidemia }}
                                    </div>
                                    <div class="form-group">
                                        <label>Stroke</label>
                                        {{ form.stroke }}
                                    </div>
                                    <div class="form-group">
                                        <label>Gout</label>
                                        {{ form.gout }}
                                    </div>
                                </div>
                            </div>

                            <!-- Exercise Restrictions -->
                            <div class="section-header">
                                <h5><i class="fas fa-ban"></i> Exercise Restrictions</h5>
                            </div>
                            <div class="form-group">
                                <div class="checkbox-group">
                                    {{ form.exercise_restrictions }}
                                    <label>Is there any reason not mentioned why you should not follow a regular exercise program?</label>
                                </div>
                                {{ form.exercise_restrictions_details }}
                            </div>
                            <div class="form-group">
                                <div class="checkbox-group">
                                    {{ form.chest_pain_exercise }}
                                    <label>Have you recently experienced chest pain associated with exercise or stress?</label>
                                </div>
                                {{ form.chest_pain_details }}
                            </div>

                            <!-- Smoking -->
                            <div class="section-header">
                                <h5><i class="fas fa-smoking-ban"></i> Smoking History</h5>
                            </div>
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="form-group">
                                        <label>Smoking Status</label>
                                        {{ form.smoking_status }}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Date Quit (if applicable)</label>
                                        {{ form.smoking_quit_date }}
                                    </div>
                                </div>
                            </div>

                            <!-- Musculoskeletal Information -->
                            <div class="section-header">
                                <h5><i class="fas fa-bone"></i> Musculoskeletal Information</h5>
                                <small>Please describe any past or current conditions such as muscle pulls, sprains, fractures, surgery, back pain, or general discomfort</small>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Head/Neck</label>
                                        {{ form.head_neck_issues }}
                                    </div>
                                    <div class="form-group">
                                        <label>Upper Back</label>
                                        {{ form.upper_back_issues }}
                                    </div>
                                    <div class="form-group">
                                        <label>Shoulder/Clavicle</label>
                                        {{ form.shoulder_clavicle_issues }}
                                    </div>
                                    <div class="form-group">
                                        <label>Arm/Elbow</label>
                                        {{ form.arm_elbow_issues }}
                                    </div>
                                    <div class="form-group">
                                        <label>Wrist/Hand</label>
                                        {{ form.wrist_hand_issues }}
                                    </div>
                                    <div class="form-group">
                                        <label>Arthritis</label>
                                        {{ form.arthritis_details }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Lower Back</label>
                                        {{ form.lower_back_issues }}
                                    </div>
                                    <div class="form-group">
                                        <label>Hip/Pelvis</label>
                                        {{ form.hip_pelvis_issues }}
                                    </div>
                                    <div class="form-group">
                                        <label>Thigh/Knee</label>
                                        {{ form.thigh_knee_issues }}
                                    </div>
                                    <div class="form-group">
                                        <label>Hernia</label>
                                        {{ form.hernia_details }}
                                    </div>
                                    <div class="form-group">
                                        <label>Surgeries</label>
                                        {{ form.surgeries_details }}
                                    </div>
                                    <div class="form-group">
                                        <label>Other</label>
                                        {{ form.other_musculoskeletal }}
                                    </div>
                                </div>
                            </div>

                            <!-- Nutritional Information -->
                            <div class="section-header">
                                <h5><i class="fas fa-utensils"></i> Nutritional Information</h5>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <div class="checkbox-group">
                                            {{ form.on_diet_plan }}
                                            <label>Are you on any specific food/diet plan?</label>
                                        </div>
                                        {{ form.diet_plan_details }}
                                    </div>
                                    <div class="form-group">
                                        <div class="checkbox-group">
                                            {{ form.taking_supplements }}
                                            <label>Do you take dietary supplements?</label>
                                        </div>
                                        {{ form.supplements_list }}
                                    </div>
                                    <div class="checkbox-group">
                                        {{ form.weight_fluctuations }}
                                        <label>Do you experience frequent weight fluctuations?</label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <div class="checkbox-group">
                                            {{ form.recent_weight_change }}
                                            <label>Have you experienced recent weight gain or loss?</label>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <label>Weight Change</label>
                                                {{ form.weight_change_amount }}
                                            </div>
                                            <div class="col-md-6">
                                                <label>Over How Long?</label>
                                                {{ form.weight_change_duration }}
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Caffeine Beverages Daily</label>
                                        {{ form.caffeine_beverages_daily }}
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>How would you describe your current nutritional habits?</label>
                                        {{ form.nutritional_habits_description }}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label>Other food/nutritional issues (food allergies, mealtimes, etc.)</label>
                                        {{ form.food_allergies_issues }}
                                    </div>
                                </div>
                            </div>

                            <!-- Work and Exercise Habits -->
                            <div class="section-header">
                                <h5><i class="fas fa-briefcase"></i> Work and Exercise Habits</h5>
                            </div>
                            <div class="form-group">
                                <label>Work and Exercise Activity Level</label>
                                {{ form.work_exercise_habits }}
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Work Stress Level</label>
                                        {{ form.work_stress_level }}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label>Home Stress Level</label>
                                        {{ form.home_stress_level }}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="checkbox-group mt-4">
                                        {{ form.works_over_40_hours }}
                                        <label>Do you work more than 40 hours a week?</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Additional Comments -->
                            <div class="section-header">
                                <h5><i class="fas fa-comments"></i> Additional Comments</h5>
                            </div>
                            <div class="form-group">
                                <label>Please make any other comments you feel are pertinent to your exercise program</label>
                                {{ form.additional_comments }}
                            </div>

                            <!-- Form Actions -->
                            <div class="row mt-4">
                                <div class="col-md-12">
                                    <button type="submit" class="btn btn-primary btn-lg">
                                        <i class="fas fa-save"></i> {% if is_new %}Submit Health History{% else %}Update Health History{% endif %}
                                    </button>
                                    <!--  -->
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Dynamic medication form management
        let medicationFormCount = {{ medication_formset.total_form_count }};

        function addMedicationForm() {
            const formsetDiv = document.getElementById('medication-section');
            const emptyForm = document.querySelector('.medication-formset').cloneNode(true);
            
            // Update form indices
            const formRegex = RegExp(`medications-(\\d+)-`, 'g');
            emptyForm.innerHTML = emptyForm.innerHTML.replace(formRegex, `medications-${medicationFormCount}-`);
            
            // Clear values
            emptyForm.querySelectorAll('input, textarea, select').forEach(field => {
                if (field.type !== 'hidden') {
                    field.value = '';
                }
            });
            
            // Update form counter in header
            emptyForm.querySelector('h6').textContent = `Medication ${medicationFormCount + 1}`;
            
            formsetDiv.appendChild(emptyForm);
            
            // Update management form
            const totalForms = document.querySelector('#id_medications-TOTAL_FORMS');
            totalForms.value = parseInt(totalForms.value) + 1;
            medicationFormCount++;
        }

        function removeMedicationForm(element) {
            const formDiv = element.closest('.medication-formset');
            formDiv.remove();
            
            // Update management form
            const totalForms = document.querySelector('#id_medications-TOTAL_FORMS');
            totalForms.value = parseInt(totalForms.value) - 1;
        }

        // Show/hide conditional fields
        document.addEventListener('DOMContentLoaded', function() {
            // Show medication section only if taking medications
            const takingMedsCheckbox = document.querySelector('#id_taking_medications');
            const medicationSection = document.querySelector('#medication-section');
            
            function toggleMedicationSection() {
                if (takingMedsCheckbox.checked) {
                    medicationSection.style.display = 'block';
                } else {
                    medicationSection.style.display = 'none';
                }
            }
            
            takingMedsCheckbox.addEventListener('change', toggleMedicationSection);
            toggleMedicationSection(); // Initial state
            
            // Form validation for mandatory fields
            document.getElementById('health-history-form').addEventListener('submit', function(e) {
                const mandatoryFields = [
                    'emergency_contact_name', 'emergency_contact_relationship', 
                    'emergency_contact_phone', 'current_weight', 'current_height', 
                    'fitness_goal', 'pt_availability', 'preferred_days'
                ];
                
                let hasErrors = false;
                mandatoryFields.forEach(fieldName => {
                    const field = document.querySelector(`#id_${fieldName}`);
                    if (field && !field.value.trim()) {
                        field.classList.add('is-invalid');
                        hasErrors = true;
                    } else if (field) {
                        field.classList.remove('is-invalid');
                    }
                });
                
                if (hasErrors) {
                    e.preventDefault();
                    alert('Please fill all mandatory fields marked with *');
                }
            });
        });
    </script>
</body>
</html>